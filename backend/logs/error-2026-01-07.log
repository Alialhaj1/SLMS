2026-01-07 07:23:26 [ERROR]: ❌ Migration failed: 101_procurement_enterprise_enhancements.sql relation "chart_of_accounts" does not exist | {"length":1065,"name":"error","severity":"ERROR","code":"42P01","where":"SQL statement \"CREATE TABLE journal_entry_lines (\r\n      id SERIAL PRIMARY KEY,\r\n      journal_entry_id INTEGER NOT NULL REFERENCES journal_entries(id) ON DELETE CASCADE,\r\n      line_number INTEGER NOT NULL,\r\n      account_id INTEGER REFERENCES chart_of_accounts(id),\r\n      account_code VARCHAR(50),\r\n      description TEXT,\r\n      description_ar TEXT,\r\n      debit_amount DECIMAL(18,4) DEFAULT 0,\r\n      credit_amount DECIMAL(18,4) DEFAULT 0,\r\n      cost_center_id INTEGER REFERENCES cost_centers(id),\r\n      project_id INTEGER,\r\n      department_id INTEGER REFERENCES departments(id),\r\n      vendor_id INTEGER REFERENCES vendors(id),\r\n      customer_id INTEGER,\r\n      item_id INTEGER REFERENCES items(id),\r\n      warehouse_id INTEGER REFERENCES warehouses(id),\r\n      currency_amount DECIMAL(18,4),\r\n      exchange_rate DECIMAL(18,6),\r\n      created_at TIMESTAMP DEFAULT NOW()\r\n    )\"\nPL/pgSQL function inline_code_block line 4 at SQL statement","file":"namespace.c","line":"433","routine":"RangeVarGetRelidExtended"}
2026-01-07 07:26:40 [ERROR]: ❌ Migration failed: 101_procurement_enterprise_enhancements.sql relation "departments" does not exist | {"length":1050,"name":"error","severity":"ERROR","code":"42P01","where":"SQL statement \"CREATE TABLE journal_entry_lines (\r\n      id SERIAL PRIMARY KEY,\r\n      journal_entry_id INTEGER NOT NULL REFERENCES journal_entries(id) ON DELETE CASCADE,\r\n      line_number INTEGER NOT NULL,\r\n      account_id INTEGER REFERENCES accounts(id),\r\n      account_code VARCHAR(50),\r\n      description TEXT,\r\n      description_ar TEXT,\r\n      debit_amount DECIMAL(18,4) DEFAULT 0,\r\n      credit_amount DECIMAL(18,4) DEFAULT 0,\r\n      cost_center_id INTEGER REFERENCES cost_centers(id),\r\n      project_id INTEGER,\r\n      department_id INTEGER REFERENCES departments(id),\r\n      vendor_id INTEGER REFERENCES vendors(id),\r\n      customer_id INTEGER,\r\n      item_id INTEGER REFERENCES items(id),\r\n      warehouse_id INTEGER REFERENCES warehouses(id),\r\n      currency_amount DECIMAL(18,4),\r\n      exchange_rate DECIMAL(18,6),\r\n      created_at TIMESTAMP DEFAULT NOW()\r\n    )\"\nPL/pgSQL function inline_code_block line 4 at SQL statement","file":"namespace.c","line":"433","routine":"RangeVarGetRelidExtended"}
2026-01-07 07:27:36 [ERROR]: ❌ Migration failed: 101_procurement_enterprise_enhancements.sql column "description_ar" of relation "permissions" does not exist | {"length":140,"name":"error","severity":"ERROR","code":"42703","position":"7882","file":"parse_target.c","line":"1075","routine":"checkInsertTargets"}
2026-01-07 07:28:39 [ERROR]: ❌ Migration failed: 101_procurement_enterprise_enhancements.sql column r.role_name does not exist | {"length":112,"name":"error","severity":"ERROR","code":"42703","position":"10880","file":"parse_relation.c","line":"3665","routine":"errorMissingColumn"}
2026-01-07 07:30:03 [ERROR]: ❌ Migration failed: 101_procurement_enterprise_enhancements.sql column "approved_at" of relation "purchase_orders" already exists | {"length":284,"name":"error","severity":"ERROR","code":"42701","where":"SQL statement \"ALTER TABLE purchase_orders ADD COLUMN approved_at TIMESTAMP\"\nPL/pgSQL function inline_code_block line 10 at SQL statement","file":"tablecmds.c","line":"7279","routine":"check_for_column_name_collision"}
2026-01-07 07:31:31 [ERROR]: ❌ Migration failed: 102_procurement_configuration_layer.sql column v.vendor_code does not exist | {"length":173,"name":"error","severity":"ERROR","code":"42703","hint":"Perhaps you meant to reference the column \"v.vendor_type\".","position":"9311","file":"parse_relation.c","line":"3665","routine":"errorMissingColumn"}
2026-01-07 07:32:45 [ERROR]: ❌ Migration failed: 102_procurement_configuration_layer.sql column "description_ar" of relation "permissions" does not exist | {"length":141,"name":"error","severity":"ERROR","code":"42703","position":"10705","file":"parse_target.c","line":"1075","routine":"checkInsertTargets"}
2026-01-07 07:34:08 [ERROR]: ❌ Migration failed: 103_sales_customer_master.sql column "category_id" does not exist | {"length":101,"name":"error","severity":"ERROR","code":"42703","file":"indexcmds.c","line":"1831","routine":"ComputeIndexAttrs"}
2026-01-07 07:35:58 [ERROR]: ❌ Migration failed: 103_sales_customer_master.sql column pl.price_list_type does not exist | {"length":119,"name":"error","severity":"ERROR","code":"42703","position":"22010","file":"parse_relation.c","line":"3665","routine":"errorMissingColumn"}
2026-01-07 07:37:51 [ERROR]: ❌ Migration failed: 104_sales_phase2_enhancements.sql relation "inventory_transactions" does not exist | {"length":124,"name":"error","severity":"ERROR","code":"42P01","position":"42568","file":"parse_relation.c","line":"1392","routine":"parserOpenTable"}
2026-01-07 07:39:30 [ERROR]: ❌ Migration failed: 104_sales_phase2_enhancements.sql column "quantity" does not exist | {"length":1170,"name":"error","severity":"ERROR","code":"42703","internalPosition":"539","internalQuery":"\r\n    CREATE OR REPLACE VIEW v_item_availability AS\r\n    SELECT \r\n        i.id as item_id,\r\n        i.company_id,\r\n        i.code as item_code,\r\n        i.name as item_name,\r\n        w.id as warehouse_id,\r\n        w.name as warehouse_name,\r\n        COALESCE(inv.qty_on_hand, 0) as qty_on_hand,\r\n        COALESCE(res.reserved_qty, 0) as reserved_qty,\r\n        COALESCE(inv.qty_on_hand, 0) - COALESCE(res.reserved_qty, 0) as available_qty\r\n    FROM items i\r\n    CROSS JOIN warehouses w\r\n    LEFT JOIN LATERAL (\r\n        SELECT COALESCE(SUM(quantity), 0) as qty_on_hand\r\n        FROM inventory_movements\r\n        WHERE item_id = i.id AND warehouse_id = w.id\r\n    ) inv ON true\r\n    LEFT JOIN LATERAL (\r\n        SELECT COALESCE(SUM(remaining_qty), 0) as reserved_qty\r\n        FROM inventory_reservations\r\n        WHERE item_id = i.id AND warehouse_id = w.id AND status = 'ACTIVE'\r\n    ) res ON true\r\n    WHERE i.deleted_at IS NULL \r\n      AND w.deleted_at IS NULL\r\n      AND w.company_id = i.company_id\r\n    ","where":"PL/pgSQL function inline_code_block line 4 at EXECUTE","file":"parse_relation.c","line":"3665","routine":"errorMissingColumn"}
2026-01-07 08:04:12 [ERROR]: ❌ Migration failed: 105_add_contract_types_permissions.sql column "name" of relation "permissions" does not exist | {"length":129,"name":"error","severity":"ERROR","code":"42703","position":"170","file":"parse_target.c","line":"1075","routine":"checkInsertTargets"}
2026-01-07 10:12:28 [ERROR]: ❌ Migration failed: 106_seed_procurement_enterprise_reference_data.sql column "description_ar" of relation "contract_statuses" does not exist | {"length":147,"name":"error","severity":"ERROR","code":"42703","position":"13266","file":"parse_target.c","line":"1075","routine":"checkInsertTargets"}
2026-01-07 13:12:38 [ERROR]: ❌ Migration failed: 100_seed_procurement_data.sql insert or update on table "vendor_categories" violates foreign key constraint "vendor_categories_created_by_fkey" | {"length":299,"name":"error","severity":"ERROR","code":"23503","detail":"Key (created_by)=(1) is not present in table \"users\".","schema":"public","table":"vendor_categories","constraint":"vendor_categories_created_by_fkey","file":"ri_triggers.c","line":"2619","routine":"ri_ReportViolation"}
2026-01-07 13:17:58 [ERROR]: ❌ Migration failed: 100_seed_procurement_data.sql record "new" has no field "receivable_account_id" | {"length":3695,"name":"error","severity":"ERROR","code":"42703","where":"SQL expression \"TG_TABLE_NAME = 'customers' AND NEW.receivable_account_id IS NULL\"\nPL/pgSQL function create_partner_account() line 8 at IF\nSQL statement \"INSERT INTO vendors (company_id, code, name, name_ar, vendor_type, status_id, category_id, type_id, \r\n                         phone, email, address, credit_limit, currency_id, status, created_by)\r\n    SELECT * FROM (VALUES\r\n        (1, 'VND-001', 'Al-Rajhi Trading Co.', 'شركة الراجحي للتجارة', 'supplier', v_approved_status_id, v_local_category_id, v_materials_type_id,\r\n         '+966-11-4567890', 'info@alrajhi-trading.sa', 'Riyadh Industrial Area', 500000.00, v_sar_id, 'active', v_user_id),\r\n        (1, 'VND-002', 'Gulf Petrochemicals', 'الخليج للبتروكيماويات', 'supplier', v_approved_status_id, v_local_category_id, v_materials_type_id,\r\n         '+966-13-8901234', 'sales@gulfpetro.com', 'Jubail Industrial City', 1000000.00, v_sar_id, 'active', v_user_id),\r\n        (1, 'VND-003', 'Emirates Steel Industries', 'الإمارات للصناعات الحديدية', 'supplier', v_approved_status_id, v_intl_category_id, v_materials_type_id,\r\n         '+971-4-3456789', 'orders@emiratessteel.ae', 'Dubai Industrial City, UAE', 2000000.00, v_usd_id, 'active', v_user_id),\r\n        (1, 'VND-004', 'MAERSK Shipping', 'ميرسك للشحن', 'freight', v_approved_status_id, v_freight_category_id, v_freight_type_id,\r\n         '+45-3363-3363', 'booking@maersk.com', 'Copenhagen, Denmark', 500000.00, v_usd_id, 'active', v_user_id),\r\n        (1, 'VND-005', 'SAL Saudi Logistics', 'سال السعودية للخدمات اللوجستية', 'freight', v_approved_status_id, v_local_category_id, v_freight_type_id,\r\n         '+966-12-6789012', 'logistics@sal.com.sa', 'Jeddah Islamic Port', 300000.00, v_sar_id, 'active', v_user_id),\r\n        (1, 'VND-006', 'German Machinery GmbH', 'الآلات الألمانية', 'supplier', v_approved_status_id, v_intl_category_id, v_materials_type_id,\r\n         '+49-89-12345678', 'sales@german-machinery.de', 'Munich, Germany', 1500000.00, v_eur_id, 'active', v_user_id),\r\n        (1, 'VND-007', 'China Import Export Corp', 'شركة الصين للاستيراد والتصدير', 'supplier', v_approved_status_id, v_intl_category_id, v_materials_type_id,\r\n         '+86-21-87654321', 'trade@chinaie.cn', 'Shanghai, China', 800000.00, v_usd_id, 'active', v_user_id),\r\n        (1, 'VND-008', 'Technical Solutions Ltd', 'حلول تقنية المحدودة', 'service', v_approved_status_id, v_local_category_id, v_services_type_id,\r\n         '+966-11-2345678', 'support@techsolutions.sa', 'Riyadh', 200000.00, v_sar_id, 'active', v_user_id),\r\n        (1, 'VND-009', 'Al-Khaleej Customs Clearance', 'الخليج للتخليص الجمركي', 'freight', v_approved_status_id, v_freight_category_id, v_freight_type_id,\r\n         '+966-13-5678901', 'clearance@alkhaleej.sa', 'Dammam Port', 150000.00, v_sar_id, 'active', v_user_id),\r\n        (1, 'VND-010', 'Saudi Industrial Supplies', 'السعودية للتوريدات الصناعية', 'supplier', v_draft_status_id, v_local_category_id, v_materials_type_id,\r\n         '+966-11-9876543', 'info@saudisupplies.sa', 'Riyadh', 250000.00, v_sar_id, 'active', v_user_id)\r\n    ) AS v(company_id, code, name, name_ar, vendor_type, status_id, category_id, type_id, phone, email, address, credit_limit, currency_id, status, created_by)\r\n    WHERE NOT EXISTS (SELECT 1 FROM vendors WHERE company_id = 1 AND code = v.code)\"\nPL/pgSQL function inline_code_block line 31 at SQL statement","file":"pl_exec.c","line":"5610","routine":"plpgsql_exec_get_datum_type_info"}
2026-01-07 13:21:23 [ERROR]: ❌ Migration failed: 106_seed_procurement_enterprise_reference_data.sql column "description_ar" of relation "contract_statuses" does not exist | {"length":147,"name":"error","severity":"ERROR","code":"42703","position":"13266","file":"parse_target.c","line":"1071","routine":"checkInsertTargets"}
2026-01-07 12:26:36 [ERROR]: ❌ Migration failed: 109_add_procurement_reports_dashboard_permissions.sql insert or update on table "role_permissions" violates foreign key constraint "role_permissions_role_id_fkey" | {"length":286,"name":"error","severity":"ERROR","code":"23503","detail":"Key (role_id)=(3) is not present in table \"roles\".","schema":"public","table":"role_permissions","constraint":"role_permissions_role_id_fkey","file":"ri_triggers.c","line":"2596","routine":"ri_ReportViolation"}
2026-01-07 12:35:08 [ERROR]: ❌ Migration failed: 110_add_procurement_performance_indexes.sql column "currency_code" does not exist | {"length":103,"name":"error","severity":"ERROR","code":"42703","file":"indexcmds.c","line":"1831","routine":"ComputeIndexAttrs"}
2026-01-07 12:36:06 [ERROR]: ❌ Migration failed: 110_add_procurement_performance_indexes.sql functions in index predicate must be marked IMMUTABLE | {"length":116,"name":"error","severity":"ERROR","code":"42P17","file":"indexcmds.c","line":"1748","routine":"CheckPredicate"}
2026-01-07 12:36:39 [ERROR]: ❌ Migration failed: 110_add_procurement_performance_indexes.sql column "deleted_at" does not exist | {"length":112,"name":"error","severity":"ERROR","code":"42703","position":"2536","file":"parse_relation.c","line":"3665","routine":"errorMissingColumn"}
2026-01-07 12:37:17 [ERROR]: ❌ Migration failed: 110_add_procurement_performance_indexes.sql column "quantity" does not exist | {"length":98,"name":"error","severity":"ERROR","code":"42703","file":"indexcmds.c","line":"1831","routine":"ComputeIndexAttrs"}
2026-01-07 12:37:59 [ERROR]: ❌ Migration failed: 110_add_procurement_performance_indexes.sql column "invoice_id" does not exist | {"length":100,"name":"error","severity":"ERROR","code":"42703","file":"indexcmds.c","line":"1831","routine":"ComputeIndexAttrs"}
2026-01-07 12:47:05 [ERROR]: ❌ Migration failed: 111_procurement_reference_data.sql column "name_arabic" of relation "vendor_categories" does not exist | {"length":143,"name":"error","severity":"ERROR","code":"42703","position":"4011","file":"parse_target.c","line":"1075","routine":"checkInsertTargets"}
2026-01-07 12:48:06 [ERROR]: ❌ Migration failed: 111_procurement_reference_data.sql column "requires_customs" of relation "purchase_order_types" does not exist | {"length":151,"name":"error","severity":"ERROR","code":"42703","position":"5389","file":"parse_target.c","line":"1075","routine":"checkInsertTargets"}
