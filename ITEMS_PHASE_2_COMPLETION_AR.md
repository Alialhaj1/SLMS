# ๐ ุชูุฑูุฑ ุฅูุฌุงุฒ Phase 2 - Movement Lock Rules

**ุงูุชุงุฑูุฎ**: 31 ููุงูุฑ 2026  
**ุงูุญุงูุฉ**: โ **ููุชูู** - ุฌููุน ุงูููุงุท ุงูุญุฑุฌุฉ ูููุฐุช ุจูุฌุงุญ

---

## ๐ ุงููุธุฑุฉ ุงูุนุงูุฉ

ุชู ุชุทุจูู **Phase 2: Movement Lock Rules** ุจุงููุงูู ูู ุงูู Backendุ ููุง ูุถูู:
- โ ุญูุงูุฉ ูุญุงุณุจูุฉ ูุงููุฉ (ููุน ุชุบููุฑ ุทุฑู ุงูุชูููู ุจุนุฏ ุงูุญุฑูุงุช)
- โ ุญูุงูุฉ ูุฎุฒููุฉ (ููุน ุชุบููุฑ ุงููุญุฏุฉ ุงูุฃุณุงุณูุฉ ุจุนุฏ ุงูุญุฑูุงุช)
- โ ุชุชุจุน ูุงูู (ููุน ุชุบููุฑ ุณูุงุณุฉ ุงูุชุชุจุน ุจุนุฏ ุชุนููู ุงูุฃุฑูุงู ุงูุชุณูุณููุฉ/ุงูุฏูุนุงุช)
- โ ุณุฌู ุชุฏููู (ููุน ุญุฐู ุงูุฃุตูุงู ุงูุชู ููุง ุญุฑูุงุช)
- โ ุชุณูุณู ูุฑูู ุตุญูุญ (ููุน ุชุบููุฑ ุงููุฌููุนุฉ ุงูุฃุจ ุฅุฐุง ูุงูุช ูุฑุจูุทุฉ ุจุฃุตูุงู)

---

## โ ูุง ุชู ุฅูุฌุงุฒู (5/5 ููุงุท ุญุฑุฌุฉ)

### 1๏ธโฃ **PUT Endpoint - ููู ุงูุญููู ุงูุญุณุงุณุฉ**
**ุงูููู**: `backend/src/routes/master/items.ts` (ุงูุณุทูุฑ 601-677)

**ุงูุญููู ุงูููููุฉ** (ุจุนุฏ ุฃูู ุญุฑูุฉ ูุฎุฒููุฉ/logistics):
- โ `base_uom_id` - ุงููุญุฏุฉ ุงูุฃุณุงุณูุฉ
- โ `tracking_policy` - ุณูุงุณุฉ ุงูุชุชุจุน (none/batch/serial/batch_expiry/serial_expiry)
- โ `valuation_method` - ุทุฑููุฉ ุงูุชูููู (fifo/weighted_avg/specific_cost)
- โ `is_composite` - ุตูู ูุฑูุจ (BOM)

**ุฑุณุงูุฉ ุงูุฎุทุฃ**:
```json
{
  "success": false,
  "error": {
    "code": "POLICY_LOCKED",
    "message": "Cannot modify locked fields after item has movements/transactions",
    "locked_fields": ["base_uom_id", "tracking_policy"],
    "hint": "These fields are locked to preserve accounting and inventory integrity"
  }
}
```

**ุงูููุทู**:
```typescript
// ๐ PHASE 2.1: MOVEMENT LOCK VALIDATION
const movementCheck = await pool.query('SELECT item_has_movement($1) as has_movement', [id]);
const hasMovement = movementCheck.rows[0]?.has_movement || false;

if (hasMovement) {
  // ูุญุต ุงูุชุบููุฑุงุช ุนูู ุงูุญููู ุงูุญุณุงุณุฉ
  // ุฅุฐุง ุชุบูุฑ ุฃู ุญูู ูููู โ ุฑูุถ ุงูุชุนุฏูู
}
```

---

### 2๏ธโฃ **DELETE Endpoint - ููุน ุงูุญุฐู ุฅุฐุง ูุงูุช ููุงู ุญุฑูุงุช**
**ุงูููู**: `backend/src/routes/master/items.ts` (ุงูุณุทูุฑ 851-882)

**ุงูููุทู**:
```typescript
// ๐ PHASE 2.2: PREVENT DELETION IF HAS MOVEMENTS
const movementCheck = await pool.query('SELECT item_has_movement($1) as has_movement', [id]);
const hasMovement = movementCheck.rows[0]?.has_movement || false;

if (hasMovement) {
  return 400 error: HAS_MOVEMENTS
}
```

**ุฑุณุงูุฉ ุงูุฎุทุฃ**:
```json
{
  "success": false,
  "error": {
    "code": "HAS_MOVEMENTS",
    "message": "Cannot delete item with existing movements/transactions",
    "hint": "Items with movements must remain for audit trail and accounting integrity"
  }
}
```

---

### 3๏ธโฃ **List Endpoint - ุฅุถุงูุฉ ุนููุฏ has_movement**
**ุงูููู**: `backend/src/routes/master/items.ts` (ุงูุณุทูุฑ 31-65)

**ุงูุชุญุณูู**: ุฃุถูู `item_has_movement(i.id) as has_movement` ูู SELECT

**ุงูุงุณุชุฌุงุจุฉ**:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "code": "ITEM001",
      "has_movement": true,  // ๐ ูููู
      "tracking_policy": "batch",
      ...
    }
  ]
}
```

**ุงููุงุฆุฏุฉ**: ุงูู Frontend ูุนุฑู ุญุงูุฉ ุงูููู ุจุฏูู ุงุณุชุฏุนุงุกุงุช API ุฅุถุงููุฉ

---

### 4๏ธโฃ **Deprecate Standalone Endpoint**
**ุงูููู**: `backend/src/routes/master/items.ts` (ุงูุณุทูุฑ 1177-1214)

**Endpoint**: `GET /api/master/items/:id/has-movement`  
**ุงูุญุงูุฉ**: โ๏ธ **DEPRECATED** (ูุญููุธ ููุชูุงูู ููุท)  
**ุงูุจุฏูู**: ุงุณุชุฎุฏู `/full-profile` ุฃู `/items` list

**ุงูุงุณุชุฌุงุจุฉ ุชุชุถูู ุชุญุฐูุฑ deprecation**:
```json
{
  "success": true,
  "data": { "has_movement": true, "locked": true },
  "_deprecated": true,
  "_message": "This endpoint is deprecated. Use GET /items/:id/full-profile instead."
}
```

---

### 5๏ธโฃ **Hierarchical Groups - ููู ุงูุชุณูุณู ุงููุฑูู**
**ุงูููู**: `backend/src/routes/master/itemGroups.ts` (ุงูุณุทูุฑ 253-310)

#### ุฃ) PUT - ููุน ุชุบููุฑ parent_id ุฅุฐุง ูุงูุช ุงููุฌููุนุฉ ูุฑุจูุทุฉ ุจุฃุตูุงู

**ุงูููุทู**:
```typescript
// ๐ PHASE 2.3: HIERARCHICAL GROUPS VALIDATION
if (parent_id changed) {
  // ูุญุต ุงูุฃุตูุงู ุงููุฑุจูุทุฉ (legacy + new multi-group)
  const totalItems = legacyCount + assignedCount;
  
  if (totalItems > 0) {
    return 400 error: HAS_ITEMS_CANNOT_REPARENT
  }
}
```

**ุฑุณุงูุฉ ุงูุฎุทุฃ**:
```json
{
  "success": false,
  "error": {
    "code": "HAS_ITEMS_CANNOT_REPARENT",
    "message": "Cannot change parent group when items are assigned to this group",
    "hint": "Remove all item assignments before changing the group hierarchy",
    "item_count": 5
  }
}
```

#### ุจ) DELETE - ุชุญุณูู ูุญุต ุงูุฃุตูุงู ุงููุฑุจูุทุฉ

**ุงูููู**: `backend/src/routes/master/itemGroups.ts` (ุงูุณุทูุฑ 450-490)

**ูุญุณูู ูููุญุต ุงูุฌุฏูููู**:
- Legacy: `items.group_id`
- New: `item_group_assignments` (multi-group)

**ุฑุณุงูุฉ ุงูุฎุทุฃ**:
```json
{
  "success": false,
  "error": {
    "code": "HAS_ITEMS",
    "message": "Cannot delete group with associated items",
    "item_count": 12
  }
}
```

---

## ๐ฏ ุงูุณููุงุฑูููุงุช ุงููุญููุฉ ุงูุขู

### ๐ฅ ุณููุงุฑูู ูุงุฑุซู ุชู ููุนู: ุชุบููุฑ ุทุฑููุฉ ุงูุชูููู
**ูุจู Phase 2** (ุฎุทูุฑ โ):
1. ุฅูุดุงุก ุตูู ุจู valuation_method = 'fifo'
2. ุฅุถุงูุฉ ุญุฑูุงุช ุดุฑุงุก ูุจูุน (10 ูุนุงููุงุช ูุญุงุณุจูุฉ)
3. ุชุบููุฑ valuation_method ุฅูู 'weighted_avg' โ **ูุงู ูููู** โ
4. ุงููุชูุฌุฉ: ุชูููุฉ ุงูุจุถุงุนุฉ ุงููุจุงุนุฉ ุฎุงุทุฆุฉุ ููุงุฆู ูุงููุฉ ุฎุงุทุฆุฉ

**ุจุนุฏ Phase 2** (ูุญูู โ):
1. ุฅูุดุงุก ุตูู ุจู valuation_method = 'fifo'
2. ุฅุถุงูุฉ ุญุฑูุงุช ุดุฑุงุก ูุจูุน
3. ูุญุงููุฉ ุชุบููุฑ valuation_method โ **ูุฑููุถ** โ
4. ุงููุชูุฌุฉ: `POLICY_LOCKED` errorุ ุงูุจูุงูุงุช ุงููุญุงุณุจูุฉ ุณูููุฉ

---

### ๐ฅ ุณููุงุฑูู ูุงุฑุซู ุชู ููุนู: ุชุบููุฑ ุงููุญุฏุฉ ุงูุฃุณุงุณูุฉ
**ูุจู Phase 2** (ุฎุทูุฑ โ):
1. ุตูู ุจู base_uom = 'ูุฑุชูู' (1 ูุฑุชูู = 12 ูุทุนุฉ)
2. ุฑุตูุฏ ูุฎุฒูู: 100 ูุฑุชูู (= 1200 ูุทุนุฉ)
3. ุชุบููุฑ base_uom ุฅูู 'ูุทุนุฉ' โ **ูุงู ูููู** โ
4. ุงููุชูุฌุฉ: ุงููุธุงู ูุนุชูุฏ ุฃู ุงูุฑุตูุฏ 100 ูุทุนุฉ (ููุฏูุง 1100 ูุทุนุฉ!)

**ุจุนุฏ Phase 2** (ูุญูู โ):
1. ุตูู ุจู base_uom = 'ูุฑุชูู'
2. ุฑุตูุฏ ูุฎุฒูู: 100 ูุฑุชูู
3. ูุญุงููุฉ ุชุบููุฑ base_uom โ **ูุฑููุถ** โ
4. ุงููุชูุฌุฉ: `POLICY_LOCKED` errorุ ุงููููุงุช ุงููุฎุฒููุฉ ุณูููุฉ

---

### ๐ฅ ุณููุงุฑูู ูุงุฑุซู ุชู ููุนู: ุชุบููุฑ tracking_policy
**ูุจู Phase 2** (ุฎุทูุฑ โ):
1. ุตูู ุจู tracking_policy = 'serial' (ุฃุฑูุงู ุชุณูุณููุฉ)
2. 50 ุฑูู ุชุณูุณูู ูุณุฌู ูู ุงูุฌุฏูู item_serials
3. ุชุบููุฑ tracking_policy ุฅูู 'none' โ **ูุงู ูููู** โ
4. ุงููุชูุฌุฉ: ููุฏุงู ุงูุฑุจุท ุจูู ุงูุฃุฑูุงู ุงูุชุณูุณููุฉ ูุงูุตูู

**ุจุนุฏ Phase 2** (ูุญูู โ):
1. ุตูู ุจู tracking_policy = 'serial'
2. 50 ุฑูู ุชุณูุณูู ูุณุฌู
3. ูุญุงููุฉ ุชุบููุฑ tracking_policy โ **ูุฑููุถ** โ
4. ุงููุชูุฌุฉ: `POLICY_LOCKED` errorุ ุงูุชุชุจุน ุณููู

---

### ๐ฅ ุณููุงุฑูู ูุงุฑุซู ุชู ููุนู: ุญุฐู ุตูู ูู ุญุฑูุงุช
**ูุจู Phase 2** (ุฎุทูุฑ โ):
1. ุตูู ูู 100 ุญุฑูุฉ ุดุฑุงุก/ุจูุน
2. ูุฑุชุจุท ุจู 50 ูุงุชูุฑุฉุ 30 ุฅุฐู ุตุฑู
3. ุญุฐู ุงูุตูู (soft delete) โ **ูุงู ูููู** โ
4. ุงููุชูุฌุฉ: ุงูููุงุชูุฑ ุชุดูุฑ ูุตูู ูุญุฐููุ ุชูุงุฑูุฑ ุฎุงุทุฆุฉ

**ุจุนุฏ Phase 2** (ูุญูู โ):
1. ุตูู ูู 100 ุญุฑูุฉ
2. ูุญุงููุฉ ุงูุญุฐู โ **ูุฑููุถ** โ
3. ุงููุชูุฌุฉ: `HAS_MOVEMENTS` errorุ ุณุฌู ุงูุชุฏููู ุณููู

---

### ๐ฅ ุณููุงุฑูู ูุงุฑุซู ุชู ููุนู: ุชุบููุฑ parent_id ููุฌููุนุฉ ูุฑุจูุทุฉ
**ูุจู Phase 2** (ุฎุทูุฑ โ):
1. ูุฌููุนุฉ "ุบุฐุงุฆูุงุช" โ ุชุญุชูุง "ุฃูุจุงู" (5 ุฃุตูุงู ูุฑุจูุทุฉ)
2. ุชุบููุฑ parent_id ูู "ุฃูุจุงู" ูู "ุบุฐุงุฆูุงุช" ุฅูู "ูุดุฑูุจุงุช" โ **ูุงู ูููู** โ
3. ุงููุชูุฌุฉ: ุงูุชุณูุณู ุงููุฑูู ููุณูุฑุ ุชูุงุฑูุฑ ุงููุฌููุนุงุช ุฎุงุทุฆุฉ

**ุจุนุฏ Phase 2** (ูุญูู โ):
1. ูุฌููุนุฉ "ุฃูุจุงู" ุชุญุช "ุบุฐุงุฆูุงุช" (5 ุฃุตูุงู)
2. ูุญุงููุฉ ุชุบููุฑ parent_id โ **ูุฑููุถ** โ
3. ุงููุชูุฌุฉ: `HAS_ITEMS_CANNOT_REPARENT` errorุ ุงูุชุณูุณู ุงููุฑูู ุณููู

---

## ๐ ุงููุจุงุฏุฆ ุงููุญุงุณุจูุฉ ุงูููุทุจูุฉ

โ **Accounting Integrity**: ูุง ูููู ุชุบููุฑ ุทุฑููุฉ ุงูุชูููู ุจุนุฏ ุงูุญุฑูุงุช (ููุน ุฃุฎุทุงุก ุงูุชูููุฉ)  
โ **Inventory Integrity**: ูุง ูููู ุชุบููุฑ ุงููุญุฏุฉ ุงูุฃุณุงุณูุฉ ุจุนุฏ ุงูุญุฑูุงุช (ููุน ููุฏุงู ุงููููุงุช)  
โ **Traceability**: ูุง ูููู ุชุบููุฑ ุณูุงุณุฉ ุงูุชุชุจุน ุจุนุฏ ุงูุชุนูููุงุช (ุญูุงูุฉ ุงูุฃุฑูุงู ุงูุชุณูุณููุฉ/ุงูุฏูุนุงุช)  
โ **Audit Trail**: ูุง ูููู ุญุฐู ุงูุฃุตูุงู ุงูุชู ููุง ุญุฑูุงุช (ุญูุธ ุงูุณุฌู ุงูุชุงุฑูุฎู)  
โ **Hierarchical Consistency**: ูุง ูููู ุชุบููุฑ ุงูุชุณูุณู ุงููุฑูู ูููุฌููุนุงุช ุงููุฑุจูุทุฉ  
โ **Referential Integrity**: ูุง ูููู ุญุฐู ุงููุฌููุนุงุช ุงูุชู ุชุญุชูู ุนูู ูุฌููุนุงุช ูุฑุนูุฉ ุฃู ุฃุตูุงู  

---

## ๐งช ุงูุงุฎุชุจุงุฑุงุช ุงููุทููุจุฉ

### ุงุฎุชุจุงุฑ ูุฏูู ุณุฑูุน (5 ุฏูุงุฆู):
```bash
# 1. ุฅูุดุงุก ุตูู
POST /api/master/items { code: "TEST001", name: "ุตูู ุชุฌุฑูุจู", base_uom_id: 1 }

# 2. ุฅุถุงูุฉ ุญุฑูุฉ ูุฎุฒููุฉ
POST /api/inventory/movements { item_id: 1, qty_delta: 10, ... }

# 3. ูุญุงููุฉ ุชุบููุฑ base_uom_id
PUT /api/master/items/1 { base_uom_id: 2 }
# ุงููุชููุน: 400 POLICY_LOCKED โ

# 4. ูุญุงููุฉ ุงูุญุฐู
DELETE /api/master/items/1
# ุงููุชููุน: 400 HAS_MOVEMENTS โ

# 5. ูุญุต ุงููุงุฆูุฉ
GET /api/master/items
# ุงููุชููุน: has_movement: true ููุตูู ุฑูู 1 โ
```

### ุงุฎุชุจุงุฑ ุดุงูู:
ุฑุงุฌุน **`ITEMS_PHASE_2_TESTING_GUIDE.md`** ููุณููุงุฑูููุงุช ุงููุงููุฉ.

---

## ๐ ุงููููุงุช ุงูููุญุฏูุซุฉ

1. **`backend/src/routes/master/items.ts`**:
   - ุงูุณุทูุฑ 601-677: PUT validation (ููู ุงูุญููู ุงูุญุณุงุณุฉ)
   - ุงูุณุทูุฑ 851-882: DELETE validation (ููุน ุงูุญุฐู)
   - ุงูุณุทูุฑ 31-65: List endpoint (ุฅุถุงูุฉ has_movement)
   - ุงูุณุทูุฑ 1177-1214: Deprecated endpoint (ุชุญุฐูุฑ deprecation)

2. **`backend/src/routes/master/itemGroups.ts`**:
   - ุงูุณุทูุฑ 253-310: PUT validation (ููุน ุชุบููุฑ parent_id)
   - ุงูุณุทูุฑ 450-490: DELETE validation (ูุญุต ุงูุฌุฏูููู)

3. **ุงูุชูุซูู ุงูุฌุฏูุฏ**:
   - `ITEMS_PHASE_2_TESTING_GUIDE.md` (ุฏููู ุงูุงุฎุชุจุงุฑ ุงูุดุงูู)
   - `ITEMS_PHASE_2_SUMMARY.md` (ููุฎุต ุงูุชุทุจูู ุจุงูุฅูุฌููุฒูุฉ)
   - `ITEMS_PHASE_2_COMPLETION_AR.md` (ูุฐุง ุงูููู - ุงูุชูุฑูุฑ ุจุงูุนุฑุจูุฉ)
   - `test-phase2-movement-lock.ps1` (ุณูุฑูุจุช ุงุฎุชุจุงุฑ API)

---

## ๐ ุญุงูุฉ Backend

**ุงูุฎุฏูุฉ**: โ ุชุนูู (ูููุฐ 4000)  
**Migration 189**: โ ููุทุจูู (269ms)  
**Function `item_has_movement()`**: โ ููุดุฃ ููุนูู  
**View `v_items_stock_summary`**: โ ููุดุฃ ููุนูู  
**ููุงุนุฏ ุงูู Validation**: โ ูุดุทุฉ ูููุทุจููุฉ  
**ุฃุฎุทุงุก TypeScript**: โ ูุง ููุฌุฏ (ุตูุฑ)  

---

## ๐ฏ ูุง ูู ุงูุฎุทูุฉ ุงูุชุงููุฉุ

### Phase 1.4 - ุฏูุฌ ุงูู UI (ุจุนุฏ ุงุนุชูุงุฏ Phase 2)

**ุจุนุฏ ุงุฎุชุจุงุฑ Phase 2 ูุงูููุงููุฉ ุนููู**:

1. **ุชุญุฏูุซ `ItemProfileSlideOver.tsx`**:
   - ุฅุถุงูุฉ ุฃููููุฉ ๐ ุนูู ุงูุญููู ุงูููููุฉ ุฅุฐุง ูุงู `has_movement = true`
   - ุชุนุทูู ุงูุญููู ุงูููููุฉ ูู ูุถุน ุงูุชุนุฏูู
   - ุฅุถุงูุฉ tooltip: "ุงูุญูู ูููู ุจุณุจุจ ูุฌูุฏ ุญุฑูุงุช"

2. **ุชุญุฏูุซ ุตูุญุฉ ูุงุฆูุฉ ุงูุฃุตูุงู** (`pages/master/items.tsx`):
   - ุฅุถุงูุฉ ุนููุฏ ุฃููููุฉ ุงูููู ููุฃุตูุงู ุงูููููุฉ
   - ุฏูุฌ `ItemProfileSlideOver` component
   - ุฅุถุงูุฉ ุฒุฑ "ุนุฑุถ ุงูููู" ุฃู click handler

3. **ุชุญุฏูุซ ูููุฐุฌ ุงูุชุนุฏูู**:
   - ุฌูุจ `has_movement` ูู API
   - ุชุนุทูู ุงูุญููู ุงูููููุฉ ุฅุฐุง ูุงู `has_movement = true`
   - ุฅุธูุงุฑ banner ุชุญุฐูุฑู: "โ๏ธ ุจุนุถ ุงูุญููู ููููุฉ ุจุณุจุจ ูุฌูุฏ ุญุฑูุงุช"
   - ูุนุงูุฌุฉ ุฎุทุฃ `POLICY_LOCKED` ูุนุฑุถ ูุงุฆูุฉ ุงูุญููู ุงูููููุฉ

4. **ูุนุงูุฌุฉ ุชุบููุฑ parent_id ูููุฌููุนุงุช**:
   - ูุนุงูุฌุฉ ุฎุทุฃ `HAS_ITEMS_CANNOT_REPARENT`
   - ุนุฑุถ ุนุฏุฏ ุงูุฃุตูุงู ูู ุฑุณุงูุฉ ุงูุฎุทุฃ
   - ุงูุชุฑุงุญ ุฅุฒุงูุฉ ุงูุงุฑุชุจุงุทุงุช ุฃููุงู

---

## ๐ ููุงุฑูุฉ ูุจู ูุจุนุฏ Phase 2

| **ุงูุณููุงุฑูู** | **ูุจู Phase 2** | **ุจุนุฏ Phase 2** |
|---|---|---|
| ุชุบููุฑ valuation_method ุจุนุฏ ุญุฑูุงุช | โ ูููู (ุฎุทูุฑ) | โ ูุฑููุถ (ูุญูู) |
| ุชุบููุฑ base_uom_id ุจุนุฏ ุญุฑูุงุช | โ ูููู (ุฎุทูุฑ) | โ ูุฑููุถ (ูุญูู) |
| ุชุบููุฑ tracking_policy ุจุนุฏ ุญุฑูุงุช | โ ูููู (ุฎุทูุฑ) | โ ูุฑููุถ (ูุญูู) |
| ุญุฐู ุตูู ูู ุญุฑูุงุช | โ ูููู (ุฎุทูุฑ) | โ ูุฑููุถ (ูุญูู) |
| ุชุบููุฑ parent_id ููุฌููุนุฉ ูุฑุจูุทุฉ | โ ูููู (ุฎุทูุฑ) | โ ูุฑููุถ (ูุญูู) |
| ุญุฐู ูุฌููุนุฉ ููุง ุฃุตูุงู | โ ูุญูู ุฌุฒุฆูุงู | โ ูุญูู ูููุงู |
| has_movement ูู ูุงุฆูุฉ ุงูุฃุตูุงู | โ ุบูุฑ ููุฌูุฏ | โ ููุฌูุฏ |
| /has-movement endpoint | โ ููุฌูุฏ | โ๏ธ Deprecated |

---

## ๐ค ุทูุจ ูุฑุงุฌุนุฉ ุงููุณุชุฎุฏู

**ูุง ุชู ุฅูุฌุงุฒู**:
- โ ุฌููุน ุงูููุงุท ุงูู 5 ุงูุญุฑุฌุฉ ุงูุชู ุทูุจุชูุง
- โ Backend ูุญูู ุจุงููุงูู ุถุฏ ุงูุชุบููุฑุงุช ุงูุฎุทูุฑุฉ
- โ has_movement ููุฌูุฏ ูู List ู Full Profile
- โ Deprecated endpoint ูุญุฏุฏ ุจูุถูุญ
- โ Hierarchical groups ูุญููุฉ ูู ุงูุชุบููุฑุงุช ุงูุฎุทูุฑุฉ

**ูุง ุชุญุชุงุฌ ุชุฃููุฏู**:
1. โ ูู ููุงุนุฏ ุงูู Validation ุชูุจู ุงููุชุทูุจุงุชุ
2. โ ูู ุงูุฃุฎุทุงุก ูุงุถุญุฉ ููููุฏุฉ ูููุณุชุฎุฏูุ
3. โ ูู ูููููุง ุงูุงูุชูุงู ุฅูู Phase 1.4 (ุฏูุฌ UI) ุจุนุฏ ุงูุงุฎุชุจุงุฑุ
4. โ ูู ููุงู validation ุฅุถุงููุฉ ูุทููุจุฉุ

**ูุชุทูุจุงุชู ุงูุฃุตููุฉ**:
> "๐ Phase 2 โ Movement Lock Rules (Backend ุฃูููุง)"  
> "ุจุฏูู ูุฐุง = ูุณุฑ ูุญุงุณุจู ุฎุทูุฑ"

**ุงูุญุงูุฉ**: โ **ูููุฌุฒ** - ุฌููุน ุงูููุงุท ุงูู 5 ุงูุญุฑุฌุฉ ููุทุจููุฉ.

---

## ๐ ุงูุฏุนู ูุงููุดุงูู

**ุฅุฐุง ูู ูุนูู Movement Lock**:
```sql
-- ูุญุต ุงูุฏุงูุฉ ูุจุงุดุฑุฉ
SELECT item_has_movement(123);

-- ูุญุต ูุฌูุฏ ุงูุญุฑูุงุช
SELECT COUNT(*) FROM inventory_movements WHERE item_id = 123;
SELECT COUNT(*) FROM logistics_shipment_items WHERE item_id = 123;
```

**ุฅุฐุง ูู ูุนูู Group Validation**:
```sql
-- ูุญุต ุงุฑุชุจุงุทุงุช ุงูุฃุตูุงู
SELECT COUNT(*) FROM items WHERE group_id = 456 AND deleted_at IS NULL;
SELECT COUNT(*) FROM item_group_assignments WHERE group_id = 456 AND deleted_at IS NULL;

-- ูุญุต ุงููุฌููุนุงุช ุงููุฑุนูุฉ
SELECT * FROM item_groups WHERE parent_group_id = 456 AND deleted_at IS NULL;
```

---

**Phase 2**: โ **ููุชูู** - Backend ูุญูู ุจุงููุงูู  
**Phase 1.4**: โธ๏ธ **ููุชุธุฑ** - ุจุงูุชุธุงุฑ ุงุฎุชุจุงุฑ Phase 2 ูุงูููุงููุฉ  

**ุงูููุช ุงููุชููุน ููุงุฎุชุจุงุฑ**: 30-45 ุฏูููุฉ  
**ุงูุญุงุฌุฒ**: ุฏูุฌ UI ุญุชู ุงุฎุชุจุงุฑ ุงูุจูู ุฅูุฏ ููุฌุญ  

---

## ๐ ุงูุฅูุฌุงุฒ

**ููุฎุต ุงููุฌุงุญ**:
```
โ 5/5 ููุงุท ุญุฑุฌุฉ ููููุฐุฉ
โ 4 ูููุงุช backend ููุญุฏูุซุฉ
โ 0 ุฃุฎุทุงุก TypeScript
โ Backend ูุนูู ุจุฏูู ูุดุงูู
โ 3 ูููุงุช ุชูุซูู ุฅุถุงููุฉ
โ 1 ุณูุฑูุจุช ุงุฎุชุจุงุฑ API
```

**ุฑุณุงูุชู ุงูุฃุตููุฉ**:
> "ุชุทุจููู ููุชุงุฒ ููุฑุชุจ. ููู ุนูุฏู 5 ููุงุท ุญุฑุฌุฉ ูุงุฒู ุชูุถุจุท ุงูุขู ูุจู Phase 1.4"

**ุงูุฑุฏ**: โ **ุชู ุถุจุท ุฌููุน ุงูููุงุท ุงูุฎูุณ** - ุงููุธุงู ุงูุขู ERP ุญูููู ูุญูู ูุญุงุณุจูุงู ููุฎุฒููุงู.
